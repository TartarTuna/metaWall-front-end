import{r as o,a as r,d as g,b as t,w,e as x,v as F,t as f,M as c,O as P,o as n,Y as j,Z as C,$ as D}from"./index.15d5d7c4.js";import{p as M}from"./image.96d7d618.js";import{b as N}from"./post.ba426873.js";const $={class:"container mt-7 px-lg-12 mb-12"},B={class:"row"},V={class:"col-lg-7"},G=t("div",{class:"card mb-5 rounded-0 border-2 titleDashBoard"},[t("h2",{class:"text-center fw-bold py-3 mb-0 fs-5"},"\u5F35\u8CBC\u52D5\u614B")],-1),I={class:"card border border-dark border-2 shadow-pushcard border8px p-5"},L={class:"form-group mb-3"},T=t("label",{for:"content fw-bold"},"\u8CBC\u6587\u5167\u5BB9",-1),U={key:0,class:"my-0 text-center fs-7 text-danger"},E={class:"mb-3"},J=["src"],O={key:2,class:"my-0 text-center fs-7 text-danger"},R={class:"d-grid gap-2 col-8 mx-auto mt-5"},S={key:0,class:"mb-0"},A={key:1,class:"spinner-border text-black",role:"status"},H=t("span",{class:"visually-hidden"},"Loading...",-1),Y=[H],Q={setup(Z){const i=o(!1),l=o(null),p=o(null),b=o(["jpg","jpeg","JPG","JPEG","png","PNG"]),d=o(null),m=o(!1),a=o({src:"",imgFile:null}),_=e=>{d.value="";const s=e.target.files[0],u=s.type.split("/")[1];if(!y(u)){d.value="\u6A94\u6848\u683C\u5F0F\u932F\u8AA4\uFF0C\u50C5\u9650\u4E0A\u50B3 jpg\u3001jpeg \u8207 png \u683C\u5F0F",p.value="";return}const v=new FileReader;v.readAsDataURL(s),v.onload=()=>{a.value.src=v.result,a.value.imgFile=s}},y=e=>!!b.value.includes(e),h=async()=>{try{const e=new FormData;e.append("image",a.value.imgFile);const{data:{imageUrl:s=""}}=await M(e);return s}catch(e){return Promise.reject(e)}},k=async()=>{if(i.value=!0,m.value=!1,d.value="",!l.value){m.value=!0,i.value=!1;return}try{let e="";a.value.imgFile&&(e=await h());const s={content:l.value};e&&(s.image=e),await N(s),alert("\u65B0\u589E\u6210\u529F"),l.value=null,p.value="",a.value.imgFile=null,a.value.src=null}catch(e){console.log(e),alert(e.message)}finally{i.value=!1}};return(e,s)=>(n(),r(P,null,[g(j),t("section",$,[t("div",B,[t("div",V,[G,t("div",I,[t("form",{onSubmit:s[2]||(s[2]=w(()=>{},["prevent"]))},[t("div",L,[T,x(t("textarea",{"onUpdate:modelValue":s[0]||(s[0]=u=>l.value=u),class:"form-control border border-dark border-2",type:"text",id:"content",rows:"5",placeholder:"\u8F38\u5165\u60A8\u7684\u8CBC\u6587\u5167\u5BB9"},null,512),[[F,l.value]])]),m.value&&!l.value?(n(),r("div",U,f("\u8ACB\u586B\u5BEB\u8CBC\u6587\u5167\u5BB9"))):c("",!0),t("div",E,[t("input",{ref_key:"inputFile",ref:p,type:"file",class:"d-none",placeholder:"\u4E0A\u50B3\u5716\u7247",onChange:_},null,544),t("button",{class:"btn btn-dark border",style:{"border-radius":"8px"},onClick:s[1]||(s[1]=u=>e.$refs.inputFile.click())}," \u4E0A\u50B3\u5716\u7247 ")]),a.value.src?(n(),r("img",{key:1,src:a.value.src,alt:"photo",class:"w-100 img-fluid mb-2"},null,8,J)):c("",!0),d.value?(n(),r("div",O,f(d.value),1)):c("",!0),t("div",R,[t("button",{class:"btn btn-gray-dark border border-dark border-2 fw-bold py-3 border8px",type:"submit",onClick:k},[i.value?c("",!0):(n(),r("p",S,"\u9001\u51FA\u8CBC\u6587")),i.value?(n(),r("div",A,Y)):c("",!0)])])],32)])]),g(C)])]),g(D)],64))}};export{Q as default};
