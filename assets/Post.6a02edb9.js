import{r as l,o as r,b as n,e as g,W as x,d as t,f as w,v as F,t as f,M as d,X as P,Y as j,Q as C}from"./index.940f7d9d.js";import{p as D}from"./image.1f456f03.js";import{a as M}from"./post.33086e49.js";const N={class:"container mt-7 px-lg-12 mb-12"},B={class:"row"},V={class:"col-lg-7"},$=t("div",{class:"card mb-5 rounded-0 border-2 titleDashBoard"},[t("h2",{class:"text-center fw-bold py-3 mb-0 fs-5"},"\u5F35\u8CBC\u52D5\u614B")],-1),G={class:"card border border-dark border-2 shadow-pushcard border8px p-5"},I={class:"form-group mb-3"},L=t("label",{for:"content fw-bold"},"\u8CBC\u6587\u5167\u5BB9",-1),T={key:0,class:"my-0 text-center fs-7 text-danger"},U={class:"mb-3"},E=["src"],J={key:2,class:"my-0 text-center fs-7 text-danger"},R={class:"d-grid gap-2 col-8 mx-auto mt-5"},A={key:0,class:"mb-0"},H={key:1,class:"spinner-border text-black",role:"status"},O=t("span",{class:"visually-hidden"},"Loading...",-1),Q=[O],q={setup(S){const i=l(!1),o=l(null),p=l(null),_=l(["jpg","jpeg","JPG","JPEG","png","PNG"]),c=l(null),m=l(!1),a=l({src:"",imgFile:null}),b=e=>{c.value="";const s=e.target.files[0],u=s.type.split("/")[1];if(!y(u)){c.value="\u6A94\u6848\u683C\u5F0F\u932F\u8AA4\uFF0C\u50C5\u9650\u4E0A\u50B3 jpg\u3001jpeg \u8207 png \u683C\u5F0F",p.value="";return}const v=new FileReader;v.readAsDataURL(s),v.onload=()=>{a.value.src=v.result,a.value.imgFile=s}},y=e=>!!_.value.includes(e),h=async()=>{try{const e=new FormData;e.append("image",a.value.imgFile);const{data:{imageUrl:s=""}}=await D(e);return s}catch(e){return Promise.reject(e)}},k=async()=>{if(i.value=!0,m.value=!1,c.value="",!o.value){m.value=!0,i.value=!1;return}try{let e="";a.value.imgFile&&(e=await h());const s={content:o.value};e&&(s.image=e),await M(s),alert("\u65B0\u589E\u6210\u529F"),o.value=null,p.value="",a.value.imgFile=null,a.value.src=null}catch(e){console.log(e),alert(e.message)}finally{i.value=!1}};return(e,s)=>(r(),n(C,null,[g(x),t("section",N,[t("div",B,[t("div",V,[$,t("div",G,[t("form",null,[t("div",I,[L,w(t("textarea",{"onUpdate:modelValue":s[0]||(s[0]=u=>o.value=u),class:"form-control border border-dark border-2",type:"text",id:"content",rows:"5",placeholder:"\u8F38\u5165\u60A8\u7684\u8CBC\u6587\u5167\u5BB9"},null,512),[[F,o.value]])]),m.value&&!o.value?(r(),n("div",T,f("\u8ACB\u586B\u5BEB\u8CBC\u6587\u5167\u5BB9"))):d("",!0),t("div",U,[t("input",{ref_key:"inputFile",ref:p,type:"file",class:"d-none",placeholder:"\u4E0A\u50B3\u5716\u7247",onChange:b},null,544),t("button",{class:"btn btn-dark border",style:{"border-radius":"8px"},onClick:s[1]||(s[1]=u=>e.$refs.inputFile.click())}," \u4E0A\u50B3\u5716\u7247 ")]),a.value.src?(r(),n("img",{key:1,src:a.value.src,alt:"photo",class:"w-100 img-fluid mb-2"},null,8,E)):d("",!0),c.value?(r(),n("div",J,f(c.value),1)):d("",!0),t("div",R,[t("button",{class:"btn btn-gray-dark border border-dark border-2 fw-bold py-3 border8px",type:"submit",onClick:k},[i.value?d("",!0):(r(),n("p",A,"\u9001\u51FA\u8CBC\u6587")),i.value?(r(),n("div",H,Q)):d("",!0)])])])])]),g(P)])]),g(j)],64))}};export{q as default};
