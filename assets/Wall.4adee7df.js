import{M as S,r as d,N as j,O as K,a as u,d as p,b as h,P as k,f as O,Q as y,L as $,R as A,u as F,h as g,o as i,i as Q,S as x}from"./index.750991ee.js";import{g as T}from"./post.2a1a06e1.js";import{_ as U}from"./PostFilter.fde69488.js";import{E as C,_ as W}from"./PostCard.dc4fe7dd.js";import"./like.ff68e6ae.js";import"./day.22152a0f.js";import"./_commonjsHelpers.4e997714.js";import"./image.dbbbd8ec.js";const z={class:"container mt-7 px-lg-12 mb-12"},G={class:"row d-flex justify-content-center"},H={class:"col-12 col-lg-7"},J=Q("\u8F09\u5165\u4E2D..."),X={key:1,class:"ps-0"},ie={name:"Wall",setup(Y){const _=S("https://metawall-06.herokuapp.com"),w=F(),m=d(!0),f=d("desc"),P=d(""),n=d([]),v=d(0);_.on("connect",()=>{console.log(_.id)}),_.on("newPost",e=>{e&&v.value++});let l=j().query;K(async e=>{l=e.query,await r({reset:!0})});const B=async()=>{const e={createdAt:f.value,q:P.value};l&&l.post&&(e._id=l.post);const{data:t}=await T(e);return t},r=async({reset:e=!1}={})=>{try{m.value=!0,e&&(n.value=[]);const t=await B();n.value.push(...t)}finally{m.value=!1}},N=e=>{f.value=e,r({reset:!0})},L=e=>{P.value=e,r({reset:!0})},R=e=>{n.value.find(o=>o._id===e).likes.push({_id:x.value._id})},b=e=>{const t=n.value.find(s=>s._id===e),o=t.likes.findIndex(s=>s._id===x.value._id);~o&&t.likes.splice(o,1)},E=({postId:e,comment:t})=>{n.value.find(s=>s._id===e).comments.push(t)},q=({postId:e,commentId:t,content:o})=>{const a=n.value.find(c=>c._id===e).comments.find(c=>c._id===t);a.content=o},V=({postId:e,commentId:t})=>{const o=n.value.find(a=>a._id===e),s=o.comments.findIndex(a=>a._id===t);~s&&o.comments.splice(s,1)},D=({postId:e,content:t,image:o,tag:s})=>{const a=n.value.find(c=>c._id===e);a.content=t,a.tag=s,a.image=o},I=e=>{const t=n.value.findIndex(o=>o._id===e);~t&&n.value.splice(t,1)},M=()=>{v.value=0,w.push("/wall"),Object.keys(l).length||r({reset:!0})};return r(),(e,t)=>{const o=g("Navbar"),s=g("RightBar"),a=g("PhoneMenu");return i(),u(y,null,[p(o),h("section",z,[h("div",G,[h("div",H,[p(U,{loading:m.value,sort:f.value,onChangeSort:N,onChangeKeyword:L},null,8,["loading","sort"]),m.value?(i(),k(C,{key:0},{default:O(()=>[J]),_:1})):(i(),u(y,{key:1},[v.value?(i(),u("p",{key:0,class:"text-muted text-center",style:{cursor:"pointer"},onClick:M}," - \u6709\u65B0\u8CBC\u6587\u5594\uFF01\u9EDE\u64CA\u8F09\u5165 - ")):$("",!0),n.value.length?(i(),u("ul",X,[(i(!0),u(y,null,A(n.value,c=>(i(),k(W,{key:c._id,post:c,onPostLike:R,onDeleteLike:b,onPostComment:E,onEditComment:q,onDeleteComment:V,onEditPost:D,onDeletePost:I},null,8,["post"]))),128))])):(i(),k(C,{key:2}))],64))]),p(s)])]),p(a)],64)}}};export{ie as default};
