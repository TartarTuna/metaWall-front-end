import{N as $,r as i,O as z,P as F,q as G,a as r,d as v,b as d,Q as k,g as Q,R as x,M as b,S as U,o as c,j as Z,u as H,T as B,i as w}from"./index.1bb589c5.js";import{g as E}from"./post.60fc9474.js";import{_ as J}from"./PostFilter.2da222ad.js";import{u as W,E as I,_ as X}from"./PostCard.0996196a.js";import"./like.60cc8be8.js";import"./day.22152a0f.js";import"./_commonjsHelpers.4e997714.js";import"./image.bce922c1.js";const Y={class:"container mt-7 px-lg-12 mb-12"},ee={class:"row d-flex justify-content-center"},te={class:"col-12 col-lg-7"},se=Z("\u8F09\u5165\u4E2D..."),oe={key:1,class:"ps-0"},ne={key:0,class:"card py-4 px-4 mb-3 border-2 shadow-pushcard border8px position-relative text-center h-100"},ae=d("div",null,[d("span",{class:"spinner-border",role:"status","aria-hidden":"true"})],-1),ce=d("div",{class:"pt-2"},"\u8F09\u5165\u65B0\u7684\u8CBC\u6587\u4E2D...",-1),ie=[ae,ce],he={setup(le){const f=$("https://metawall-06.herokuapp.com"),N=H(),P=10,m=i(!0),_=i("desc"),h=i(""),n=i([]),y=i(0),C=i(1),g=i(!1);f.on("connect",()=>{console.log(f.id)}),f.on("newPost",e=>{e&&y.value++});let u=z().query;F(async e=>{u=e.query,await p({reset:!0})}),W(window,()=>{C.value++});const S=G(C,async e=>{g.value=!0;const{data:t}=await E({createdAt:_.value,q:h.value,pageIndex:e,pageSize:P});t.length<P&&S(),n.value.push(...t),g.value=!1}),q=async()=>{const e={createdAt:_.value,q:h.value};u&&u.post&&(e._id=u.post);const{data:t}=await E(e);return t},p=async({reset:e=!1}={})=>{try{m.value=!0,e&&(n.value=[]);const t=await q();n.value.push(...t)}finally{m.value=!1}},R=e=>{_.value=e,p({reset:!0})},L=e=>{h.value=e,p({reset:!0})},V=e=>{n.value.find(s=>s._id===e).likes.push({_id:B.value._id})},j=e=>{const t=n.value.find(o=>o._id===e),s=t.likes.findIndex(o=>o._id===B.value._id);~s&&t.likes.splice(s,1)},A=({postId:e,comment:t})=>{n.value.find(o=>o._id===e).comments.push(t)},D=({postId:e,commentId:t,content:s})=>{const a=n.value.find(l=>l._id===e).comments.find(l=>l._id===t);a.content=s},M=({postId:e,commentId:t})=>{const s=n.value.find(a=>a._id===e),o=s.comments.findIndex(a=>a._id===t);~o&&s.comments.splice(o,1)},T=({postId:e,content:t,image:s})=>{const o=n.value.find(a=>a._id===e);o.content=t,o.image=s},K=e=>{const t=n.value.findIndex(s=>s._id===e);~t&&n.value.splice(t,1)},O=()=>{y.value=0,N.push("/wall"),Object.keys(u).length||p({reset:!0})};return p(),(e,t)=>{const s=w("Navbar"),o=w("RightBar"),a=w("PhoneMenu");return c(),r(x,null,[v(s),d("section",Y,[d("div",ee,[d("div",te,[v(J,{loading:m.value,sort:_.value,onChangeSort:R,onChangeKeyword:L},null,8,["loading","sort"]),m.value?(c(),k(I,{key:0},{default:Q(()=>[se]),_:1})):(c(),r(x,{key:1},[y.value?(c(),r("p",{key:0,class:"text-muted text-center",style:{cursor:"pointer"},onClick:O}," - \u6709\u65B0\u8CBC\u6587\u5594\uFF01\u9EDE\u64CA\u8F09\u5165 - ")):b("",!0),n.value.length?(c(),r("ul",oe,[(c(!0),r(x,null,U(n.value,l=>(c(),k(X,{key:l._id,post:l,onPostLike:V,onDeleteLike:j,onPostComment:A,onEditComment:D,onDeleteComment:M,onEditPost:T,onDeletePost:K},null,8,["post"]))),128)),g.value?(c(),r("li",ne,ie)):b("",!0)])):(c(),k(I,{key:2}))],64))]),v(o)])]),v(a)],64)}}};export{he as default};
